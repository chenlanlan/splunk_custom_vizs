<form script="autodiscover.js, viz_bubblechart.js">
  <label>Bubble Chart</label>
  <fieldset submitButton="false" autoRun="true">
    <input type="time" searchWhenChanged="true">
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="text" token="term" id="input_term"/>
    <input type="text" token="category" id="input_category"/>
  </fieldset>
  <row>
    <panel>
      <html>
        <h2>Options</h2>
        <table class="table table-striped table-bordered">
          <tbody>
            <tr>
              <td><b>Name</b></td>
              <td><b>Type</b></td>
              <td><b>Default</b></td>
              <td><b>Description</b></td>
            </tr>
            <tr>
              <td><code>managerid</code></td>
              <td>string</td>
              <td>null</td>
              <td>The search manager bound to the chart.</td>
            </tr>
            <tr>
              <td><code>height</code></td>
              <td>number</td>
              <td>null</td>
              <td>The height of the chart.</td>
            </tr>
            <tr>
              <td><code>width</code></td>
              <td>number</td>
              <td>null</td>
              <td>The width of the chart.</td>
            </tr>
            <tr>
              <td><code>valueField</code></td>
              <td>string</td>
              <td>null (defaults to all)</td>
              <td>The magnitude field in the data. Circles will be sized based on this field. If the field does not exist, circles will be uniform size.</td>	
            </tr>
            <tr>
              <td><code>nameField</code></td>
              <td>string</td>
              <td>null</td>
              <td>The field used for labeling circles.</td>	
            </tr>
            <tr>
              <td><code>categoryField</code></td>
              <td>string</td>
              <td>null</td>
              <td>The field used for grouping data.</td>	
            </tr>
            <!-- Isn't being used?<tr>
              <td><code>formatLabel</code></td>
              <td>string</td>
              <td>"{name} {value}"</td>
              <td>A custom formatting function bubble labels. Takes each node name as an input and returns a formatted name.</td>	
            </tr>
            <tr>
              <td><code>formatTooltip</code></td>
              <td>string</td>
              <td>"{name}: {value}"</td>
              <td>A custom formatting function for path tooltips. Takes each node as an input and returns a formatted tooltip string.</td>	
            </tr>-->
          </tbody>
        </table>
        <h2>Events</h2>
        <table class="table table-striped table-bordered">
          <tr>
            <td><b>Name</b></td>
            <td><b>Properties</b></td>
          </tr>
          <tr>
            <td><code>click</code></td>
            <td>
              <ul>
                <li><code>name</code>: The name of the clicked bubble.</li>
                <li><code>category</code>: The category name of the clicked bubble.</li>
                <li><code>value</code>: The size value of the clicked bubble.</li>
              </ul>
            </td>
          </tr>
        </table>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <html>
        <h2>Top 30 Most Common Terms in an Ad-hoc Search Query (drilldown)</h2>
        <div id="bubblechart_search" class="splunk-manager" data-require="splunkjs/mvc/searchmanager" data-options='{
          "preview": true,
          "search": "index=_audit NOT REST: search=* | regex search_id=\"&apos;\\d+\\.\\d+&apos;\" | rex field=search max_match=0 \"(?&lt;terms&gt;\\w+)\" | eval terms=mvdedup(terms) | top limit=30 terms | lookup search_commands.csv search_command AS terms OUTPUT search_command | eval type=case(isnum(terms), \"number\", isnotnull(search_command), \"command\", 1=1, \"word\") | eval terms=if(isnum(terms), \"\\\"\"+terms+\"\\\"\", terms)",
          "earliest_time": {
            "type": "token_safe",
            "value": "$$earliest$$"
            },
          "latest_time": {
            "type": "token_safe",
            "value": "$$latest$$"
          }
        }'>
        </div>
        <div id="bubblechart" class="splunk-view" data-require="app/custom_vizs/bubblechart/bubblechart" data-options='{
          "managerid": "bubblechart_search",
          "nameField": "terms",
          "valueField": "count",
          "categoryField": "type",
          "height": 600
        }'>
        </div>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <chart id="timechart" depends="$term$">
        <title>Term: $term$ - Type: $category$</title>
        <search>
          <query>index=_audit NOT REST: "$term$" search=* | regex search_id="'\\d+\\.\\d+'" | rex field=search max_match=0 "(?&lt;terms&gt;\w+)" | search terms="$term$" | timechart count</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
        </search>
      </chart>
    </panel>
  </row>    
</form>